---
description: '発見可能性、移植性、セキュリティ、検証可能性を備えたAgent SkillsディレクトリおよびSKILL.mdファイルの作成のベストプラクティス'
applyTo: '**/SKILL.md, **/.github/skills/**, **/.claude/skills/**'
---

# Agent Skills作成のベストプラクティス

発見可能で、読みやすく、安全で、検証可能なAgent SkillsディレクトリおよびSKILL.mdファイルを作成するためのガイドライン。

## 基本原則

### 優先順位
1. セキュリティと安全性が常に最優先
2. 発見可能性（メタデータの最適化）
3. 移植性（クロスプラットフォーム互換性）
4. 最小限のコンテキスト（トークン効率）

### 設計ルール
- 各スキルを1つの明確な機能またはワークフローに限定する
- プログレッシブディスクロージャーを設計する：エージェントは`SKILL.md`を読み込む前に`name`と`description`でマッチングする
  **根拠**：アクティベーション前のメタデータがトークン予算を消費する
- メタデータは簡潔に記述する：「何をするか」＋「いつ使うか」を明示する
- クロス環境互換性のために標準仕様に準拠する（VS Code Copilot、GitHub Copilot、Claude Code）

## ディレクトリの配置

- リポジトリスコープのスキルは`.github/skills/<skill-name>/`配下に配置する
- 必要に応じてClaude専用クライアント向けに`.claude/skills/<skill-name>/`を使用する
- 各スキルを単一のディレクトリ内に収める
  **根拠**：スキル間の依存関係を防ぎ、移植性と監査可能性を低下させない

**推奨**:
```text
.github/
  skills/
    api-contract-review/
      SKILL.md
      references/
        checklist.md
      scripts/
        validate-openapi.sh
      assets/
        examples/
          sample-request.json
```

**非推奨**:
```text
.github/skills/api-contract-review/
  SKILL.md
../shared-skill-assets/   # 外部依存が移植性を低下させる
```

## ディレクトリ構造

### 必須
- `SKILL.md`をスキルディレクトリ直下に配置する

### オプション（必要な場合のみ）
- `references/`：詳細な説明、チェックリスト、手順、規約、FAQ
- `scripts/`：実行可能なスクリプトまたはヘルパーコード（最小限かつ安全に）
- `assets/`：テンプレート、例、サンプルデータ（機密情報を除外）
  **根拠**：セキュリティ第一 - シークレット、認証情報、個人データは含めない

### リファレンスのルール
- リファレンスは同一スキルディレクトリ内のファイルに限定する
- リファレンスパスの深いネストを避ける
  **根拠**：読み取りミスとリファレンスエラーを削減する
- リファレンスは浅く保つ（例：`references/<file>.md`）

## SKILL.mdのフロントマター

### 必須構造
- 1行目にYAMLフロントマターを開始する（前に空行やコメントを入れない）
- インデントにはスペースのみを使用する（タブは使わない）
  **根拠**：タブ文字はパースエラーを引き起こす可能性がある

### 必須フィールド
- `name`：スキル識別子（小文字のスラグ形式を使用）
- `description`：単一行の目的ステートメント（発見可能性の鍵）
  **根拠**：複数行ブロック（`|`、`>`）はすべてのクライアントでサポートされていない可能性がある

### 互換性に関する注意
- `description`を単一行に保つ
- 自動フォーマットツール（例：Prettier）が`description`を折り返さないようにする

### オプションフィールド（最小限に使用）
- `allowed-tools`：サポートされている場合に最小権限でリスト化
- `license`、`metadata`、`compatibility`：運用上必要な場合のみ追加

**推奨**:
```markdown
---
name: api-contract-review
description: OpenAPI/Swaggerの差分を破壊的変更についてレビューする。API仕様PRをレビューする際に使用。
metadata:
  owner: platform-team
  version: '1.0'
---

# API Contract Review

## いつ使うか
- OpenAPI/Swagger変更PRのレビュー時
- クライアント互換性に影響する破壊的変更が疑われる場合
```

**非推奨**:
```markdown

---
name: API Contract Review  # スペース/大小文字混在は識別子を不安定にする
description: |
  OpenAPIをレビューする。
  必要なときにいつでも使用。
---

# API Contract Review
```

## nameフィールドのルール

- ハイフン付きの小文字スラグ形式を使用する（例：`webapp-testing`、`api-contract-review`）
- スキルディレクトリ名を`name`フィールドと一致させる
- 過度に一般的な名前を避ける（例：`helper`、`general`、`dev`）
  **根拠**：具体的な名前は発見可能性を向上させ、混乱を防ぐ

## descriptionフィールドのルール

- 「何をするか」＋「いつ使うか」を1～2文で明示する
- より良いエージェントマッチングのためのトリガーキーワードを含める
  **例**：PRレビュー、OpenAPI、破壊的変更、マイグレーション、インシデント
- 過度に広範な記述を避ける（例：「すべてを支援する」）
  **根拠**：広範な記述はマッチング精度を低下させる
- 互換性のために単一行に保つ

**推奨**:
```yaml
description: Reactコンポーネントのアクセシビリティ(a11y)を監査し、修正を提案する。UI変更PRの作成/レビュー時に使用。
```

**非推奨**:
```yaml
description: すべてのフロントエンドの問題を解決する。いつでも使用。
```

## SKILL.mdの本文内容

- 番号付きリストまたはチェックリストを使用して手順を簡潔に記述する
- 自由度を適切に制約する
  **根拠**：明示的な入力/出力/基準により曖昧な引き継ぎを防ぐ
- 選択肢を2～3個に制限し、明示的な優先順位を付ける
  **根拠**：選択肢が多すぎる（A/B/C/D/E）と明確性が低下する
- 深いリファレンスチェーンを避ける
  **非推奨**：`SKILL.md` → `references/guide.md` → `references/details.md` → ...
- 長いコンテンツは目次付きでリファレンスファイルに移動する（本文はポインタで簡潔に保つ）

## リファレンスファイルの設計

- `SKILL.md`本文はポリシー、手順、成果物の定義に集中する
- 詳細な規約と長い例は`references/`に移動する

### 推奨されるリファレンス内容
- チェックリスト（レビュー基準、完了条件）
- 一般的な失敗と緩和策
- 成果物テンプレート（イシュー/PRコメント例）
- 目次（長いドキュメント用）

### リファレンス規則
- リファレンスを明示的に指定する（「必要に応じて読む」ではなく「次を読む」）
  **根拠**：明示的なポインタによりエージェントが必要なコンテキストにアクセスできる

**推奨**:
```markdown
## 手順
1. `references/checklist.md`を読んでレビュー基準を確認する
2. 差分から破壊的変更の有無を判断する
3. 破壊的変更がある場合は、マイグレーション手順のテンプレートとして`assets/examples/migration-note.md`を使用する
```

**非推奨**:
```markdown
## 手順
- 必要に応じて調査する
- リファレンスを任意に参照する
```

## スクリプトとアセット

### スクリプトディレクトリ
- 再現可能なタスクをサポートするスクリプトを配置する
- ツールが利用できない場合にスキルがスクリプトなしで機能するように設計する
  **根拠**：すべての環境がツール実行をサポートしているわけではない

### アセットディレクトリ
- リファレンス専用コンテンツに限定する（テンプレート、サンプル）
- 実行可能または機密性のあるコンテンツを除外する

### スクリプト/アセットのリファレンス
- リファレンス時にファイル名と目的の両方を指定する
  **根拠**：明確なコンテキストが使いやすさを向上させる

**推奨**:
```markdown
## 実行（利用可能な場合）
- OpenAPI lint: `scripts/validate-openapi.sh path/to/openapi.yaml`

## リファレンス
- 破壊的変更通知テンプレート: `assets/examples/migration-note.md`
```

**非推奨**:
```markdown
- スクリプトを実行する（どれ？どこ？引数は？結果の読み方は？）
```

## セキュリティ

### 重要な優先事項：セキュリティを常に第一に

### プロンプトインジェクションの防止
- リファレンスファイルとアセットから命令上書きフレーズを除外する
- シークレット情報収集の試みを除外する
  **根拠**：スキルコンテンツはプロンプトインジェクションベクトルになり得る

### メタデータのセキュリティ
- `description`と`metadata`から機密情報、PII、トークン、内部URLを除外する
  **根拠**：メタデータはシステムプロンプトに注入される可能性がある
- メタデータを最小限かつ安全に保つ

### スクリプト実行の安全性
以下の前提で設計する：
- 利用可能な場合はサンドボックス/隔離を使用する
- 明示的な実行許可が必要（ユーザー確認）
- 信頼されたスキルのみの許可リストを維持する
- 監査のためにすべての実行内容と結果をログに記録する
  **根拠**：スクリプト実行は高いセキュリティリスクを伴う

### シークレット管理
- `assets/`や`references/`に認証情報、秘密鍵、トークン、実際のPIIを配置しない
- 例にはプレースホルダー値を使用する（例：`YOUR_TOKEN_HERE`）
- 代わりに環境変数またはシークレットストアを参照する

**推奨**:
```markdown
## セキュリティに関する注意
- ファイルに認証情報をハードコードしない。環境変数またはシークレットストアを使用する。
- 破壊的コマンド（削除/公開/課金）にはユーザー確認を要求する。
```

**非推奨**:
```markdown
## ヒント
- `assets/prod-token.txt`のトークンを使用してAPIを呼び出す。
```

## 検証（常に必須）

### 作成後のチェック
- スキルが発見可能であることを確認する：
  - `name`と`description`が正しくパースされていることを確認
  - `SKILL.md`がフロントマターで始まることを確認
  - `description`が単一行であることを確認
- 利用可能な場合はスキル仕様ツールでディレクトリを検証する（例：`skills-ref validate <path>`）
- リファレンスファイルパスが存在し、深くネストされていないことを確認する

## 最終チェックリスト

### 構造
- [ ] `SKILL.md`の1行目が`---`で始まる
- [ ] `name`が小文字スラグ形式を使用し、ディレクトリ名と一致する
- [ ] `description`が「何を＋いつ」形式の単一行である

### 内容
- [ ] 本文は適切な制約を持つ手順/チェックリストに集中している
- [ ] 長いコンテンツは`references/`に移動され、浅く明示的なリファレンスが付いている
- [ ] スクリプトは最小限かつ安全である（破壊的操作には確認が必要）

### セキュリティ
- [ ] 認証情報、PII、または機密性の高い内部データが含まれていない
- [ ] コンテンツにプロンプトインジェクションベクトルが含まれていない
- [ ] メタデータに機密情報が含まれていない
